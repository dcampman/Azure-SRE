{
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "config": {
      "isWizard": false,
      "basics": {
        "description": "Customized description with dave **markdown**.",
        "subscription": {
          "constraints": {
            "validations": [
              {
                "isValid": "[not(contains(subscription().displayName, 'HUB'))]",
                "message": "Can't use test subscription."
              },
              {
                "permission": "Microsoft.ContainerInstance/containerGroups/*",
                "message": "Must have write permission for the extension."
              },
              {
                "permission": "Microsoft.Resources/deployments/*",
                "message": "Must have write permission for the extension."
              },
              {
                "permission": "Microsoft.Resources/deploymentScripts/*",
                "message": "Must have write permission for the extension."
              }
            ]
          },
          "resourceProviders": [
            "Microsoft.DataFactory",
            "microsoft.insights",
            "Microsoft.ManagedIdentity",
            "Microsoft.ContainerInstance",
            "Microsoft.Logic",
            "Microsoft.Management",
            "Microsoft.ApiManagement",
            "Microsoft.Storage",
            "Microsoft.DesktopVirtualization",
            "Microsoft.EventGrid",
            "Microsoft.OperationalInsights",
            "Microsoft.Web",
            "Microsoft.Compute",
            "Microsoft.Network",
            "Microsoft.ResourceGraph",
            "Microsoft.Resources"
          ]
        },
        "location": {
          "label": "Location",
          "toolTip": "Azure Region for this deployment",
          "resourceTypes": ["Microsoft.Compute/virtualMachines"],
          "allowedValues": [
            "CentralUS",
            "EastUS",
            "EastUS2",
            "NorthCentralUS",
            "SouthCentralUS",
            "WestCentralUS",
            "WestUS",
            "WestUS2",
            "WestUS3"
          ]
        }
      }
    },
    "basics": [
      {
        "name": "environment",
        "type": "Microsoft.Common.DropDown",
        "label": "Environment",
        "defaultValue": "Production",
        "toolTip": "",
        "constraints": {
          "required": true,
          "allowedValues": [
            {
              "label": "Development",
              "value": "dev"
            },
            {
              "label": "Test",
              "value": "test"
            },
            {
              "label": "Production",
              "value": "prod"
            },
            {
              "label": "Sandbox",
              "value": "sandbox"
            },
            {
              "label": "Staging",
              "value": "staging"
            },
            {
              "label": "Shared",
              "value": "shared"
            },
            {
              "label": "UAT",
              "value": "uat"
            }
          ]
        },
        "visible": true
      },
      {
        "name": "workspaceName",
        "type": "Microsoft.Common.TextBox",
        "label": "Workspace Name",
        "defaultValue": "",
        "toolTip": "Name of the workspace to include in the naming of resources.",
        "constraints": {
          "required": true,
          "regex": "",
          "validationMessage": ""
        },
        "visible": true
      },
      {
        "name": "instance",
        "type": "Microsoft.Common.TextBox",
        "label": "Instance",
        "defaultValue": "1",
        "toolTip": "Instance suffix for resources. Presented as two digits.",
        "constraints": {
          "required": false,
          "regex": "^[0-9|0-9]{1,2}$",
          "validationMessage": ""
        },
        "visible": true
      }
    ],
    "steps": [
      {
        "name": "workspaceConfig",
        "label": "Workspace Configuration",
        "elements": [
          {
            "name": "vnetSelector",
            "type": "Microsoft.Solutions.ResourceSelector",
            "label": "Select existing virtual network",
            "resourceType": "Microsoft.Network/virtualNetworks",
            "options": {
              "filter": {
                "subscription": "onBasics",
                "location": "onBasics"
              }
            }
          },
          {
            "name": "dataAutomationConfig",
            "type": "Microsoft.Common.Section",
            "label": "Data Automation Configuration",
            "elements": [
              {
                "name": "storageSelector",
                "type": "Microsoft.Solutions.ResourceSelector",
                "label": "Select storage accounts",
                "resourceType": "Microsoft.Storage/storageAccounts",
                "options": {
                  "filter": {
                    "subscription": "onBasics",
                    "location": "onBasics"
                  }
                }
              },
              {
                "name": "approverEmail",
                "type": "Microsoft.Common.TextBox",
                "label": "Approver Email",
                "defaultValue": "",
                "toolTip": "Email address of the appover responsible for validating the data is ready to be released.",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9!#$%&'*+/=?^_'{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_'{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?",
                  "validationMessage": ""
                },
                "visible": true
              }
            ],
            "visible": true
          }
        ]
      },
      {
        "name": "tags",
        "label": "Tags",
        "elements": [
          {
            "name": "tags",
            "type": "Microsoft.Common.TagsByResource",
            "resources": ["All Resources"]
          }
        ]
      }
    ],
    "outputs": {
      "environment": "[basics('environment')]",
      "workspaceName": "[basics('workspaceName')]",
      "approverEmail": "[steps('workspaceConfig').dataAutomationConfig.approverEmail]",
      "sequence": "[basics('instance')]",
      "tags": "[steps('tags').tags]"
    }
  }
}
